---
title: TCP-receive-queue
date: 2021-01-20 22:29:43
tags: Tech
---

连接过程:
1. sync队列
2. 已连接队列

数据接收过程:

- receive

- out-of-order

- backlog

- prequeue

1中描述的队列是socket队列，用来存储处于不同状态的socket实体。SYN状态是TCP三次握手的第一此握手完成之后所处的状态，内核会将处于该状态的socket存储于这个队列。在连接建立完成之后，socket会被放置在'已连接队列上'。

2中描述的队列是skb队列，用来存储通信过程中不同情景下传输的skb。详细的说明如下:

1. 假如用户态进程还没有调用recv函数，内核已经接收到数据，会将数据按顺序放置在receive队列

2. 假如用户态进程还没有调用recv函数，内核已经接收到数据，但数据是乱序的，内核会先将乱序的skb暂时存放在out-of-order队列

3. 假如用户态进程调用recv函数，进入了数据接收的上下文中，而此时网卡又接到了数据，网卡驱动会先将数据暂时放在backlog队列

4. 假如用户态进程调用recv函数，但是因为没有数据所有阻塞了，进程被挂起了，而这个时候网卡收到了数据，网卡驱动会先将数据放在prequeue队列
